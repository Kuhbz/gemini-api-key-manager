# API 密钥管理助手

一个基于 Python Flask 的轻量级本地 Web 应用，用于个人高效、安全地存储、测试和轮询使用 API 密钥。

![界面截图1](static/1.png)
![界面截图2](static/2.png)

---

## ✨ 核心功能

- **安全的加密存储**: API 密钥使用 `cryptography` 库加密后存储在本地 SQLite 数据库中，并通过 `.gitignore` 文件确保密钥和数据库本身不会被意外上传到代码仓库。
- **便捷的密钥管理**: 通过 Web 界面批量添加、删除和查看 API 密钥。
- **智能的状态测试**:
    - **一键测试**: 可手动或一键触发对所有密钥的后台并发测试。
    - **定时测试**: 系统在后台定期（默认为每小时）自动测试所有密钥。
    - **可靠的逻辑**: 使用 `gemini-2.5-pro` 模型进行测试，能准确识别因额度耗尽（`429 RESOURCE_EXHAUSTED`）或权限问题（`403 PERMISSION_DENIED`）而失效的密钥。
- **详细的错误信息**:
    - **悬浮提示**: 鼠标悬浮在“Unavailable”状态上时，会显示简短的错误摘要。
    - **点击复制**: 点击状态旁边的剪贴板图标，可以一键复制完整的原始错误信息，便于调试。
- **高效的轮询复制**:
    - 提供一个全局“快速复制”按钮。
    - **实时验证**: 在复制前对密钥进行实时有效性验证，确保用户拿到的永远是当下可用的密钥。
    - **智能排序**: 优先从可用率高、最近测试过的密钥中进行轮询。
- **动态的 Web 界面**:
    - **实时更新**: 前端页面通过 `fetch` API 每5秒自动从后端获取最新状态，无需手动刷新即可看到测试结果。
    - **动态筛选**: 支持按“可用状态”和“质保状态”对密钥进行即时筛选。
    - **本地化时间**: 所有时间戳均以北京时间（UTC+8）展示，符合中文用户习惯。

## 🚀 技术栈

- **后端**: Python 3, Flask
- **数据库**: SQLite
- **ORM**: Flask-SQLAlchemy
- **定时任务**: APScheduler
- **加密**: cryptography
- **Web 服务器**: Waitress (一个纯 Python 的生产级 WSGI 服务器)
- **前端**: 原生 JavaScript, HTML5, CSS3

## 🛠️ 安装与启动

**1. 环境准备**

- 确保您已安装 Python 3.8 或更高版本。
- (推荐) 创建并激活一个虚拟环境：
  ```bash
  python -m venv venv
  # Windows
  .\venv\Scripts\activate
  # macOS / Linux
  source venv/bin/activate
  ```

**2. 安装依赖**

项目的所有依赖都已记录在 `requirements.txt` 文件中。运行以下命令进行安装：

```bash
pip install -r requirements.txt
```

**3. 首次运行**

直接运行主程序：

```bash
python app.py
```

程序首次运行时，会自动执行以下操作：
- 在项目根目录下创建 `instance` 文件夹。
- 在 `instance` 文件夹内生成 `encryption.key` 文件，这是您所有数据的加密密钥，请务必妥善保管，**不要泄露或删除**。
- 在 `instance` 文件夹内创建 `keys.db` 数据库文件。

**4. 访问应用**

启动成功后，您会在终端看到类似以下的输出：
```
Starting Flask app on http://0.0.0.0:3000 with a test interval of 3600 seconds.
```
在浏览器中打开 [http://0.0.0.0:3000](http://0.0.0.0:3000) 即可开始使用。

## 📖 使用指南

- **添加密钥**: 在主界面的“Add New Keys”区域，将一个或多个密钥（每行一个）粘贴到文本框中，设置标签和质保期后，点击“Add Keys”即可。添加后，系统会自动在后台对新密钥进行测试。
- **测试密钥**:
    - 点击任意密钥右侧的“Test”按钮，可立即触发对该密钥的单独测试。
    - 点击主控区的“一键测试全部”按钮，可立即触发对所有密钥的并发测试。
- **复制密钥**:
    - 点击任意密钥右侧的“Copy”按钮，可复制该密钥的完整字符串。
    - 点击主控区的“Quick Copy (Round-Robin)”按钮，可安全地复制一个当前确定可用的密钥。
- **筛选密钥**: 使用主控区的下拉菜单，可以按“可用状态”或“质保状态”对列表进行筛选，页面会立即响应。
- **查看错误**: 当一个密钥状态变为“Unavailable”时，将鼠标悬浮在状态文字上可查看错误摘要。点击旁边的剪贴板图标(📋)可复制完整的错误信息。
- **删除密钥**: 点击任意密钥右侧的“Delete”按钮，在确认后即可将其从数据库中永久删除。

## 🔐 安全提示

本应用的核心设计之一是安全性。
- **加密密钥**: 您的所有 API Key 都经过加密后才存入数据库。负责加密的密钥文件位于 `instance/encryption.key`。
- **本地存储**: 密钥和数据库文件都存储在您本地的 `instance` 文件夹中。
- **版本控制**: `.gitignore` 文件已配置为忽略 `instance` 文件夹，这意味着您不会意外地将包含密钥和数据库的文件夹上传到 Git 仓库。

**请务必不要手动删除或修改 `instance/encryption.key` 文件，否则将导致所有已存储的 API Key 无法解密！**
